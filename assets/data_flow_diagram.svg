<svg viewBox="0 0 800 600"
    xmlns="http://www.w3.org/2000/svg">
    <title>V13 Data Flow Diagram</title>
    <defs>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@500&amp;display=swap');
            .label { font-family: 'Fira Code', monospace; font-size: 14px; fill: #FFFFFF; text-anchor: middle; }
            .msg { font-family: 'Fira Code', monospace; font-size: 12px; fill: #AAAAAA; text-anchor: middle; }
            .box { fill: none; stroke-width: 2; }
            .line { stroke: #333333; stroke-width: 1; stroke-dasharray: 4; }
            .arrow { stroke-width: 2; marker-end: url(#arrowhead); }
            .loop-box { fill: rgba(255, 195, 0, 0.05); stroke: #FFC300; stroke-width: 1; stroke-dasharray: 4; }
            .alt-box { fill: rgba(144, 12, 63, 0.05); stroke: #900C3F; stroke-width: 1; stroke-dasharray: 4; }
        </style>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#FFFFFF" />
        </marker>
    </defs>

    <!-- Background -->
    <rect width="800" height="600" fill="#050505" />

    <!-- Participants -->
    <!-- Audio(100), Engine(250), Overmind(400), LLM(550), UI(700) -->

    <!-- Vertical Lines -->
    <line x1="100" y1="50" x2="100" y2="550" class="line" />
    <line x1="250" y1="50" x2="250" y2="550" class="line" />
    <line x1="400" y1="50" x2="400" y2="550" class="line" />
    <line x1="550" y1="50" x2="550" y2="550" class="line" />
    <line x1="700" y1="50" x2="700" y2="550" class="line" />

    <!-- Headers -->
    <rect x="50" y="20" width="100" height="30" rx="4" fill="#581845" stroke="#FFC300" stroke-width="2"/>
    <text x="100" y="40" class="label">Audio</text>

    <rect x="200" y="20" width="100" height="30" rx="4" fill="#581845" stroke="#FF5733" stroke-width="2"/>
    <text x="250" y="40" class="label">Engine</text>

    <rect x="350" y="20" width="100" height="30" rx="4" fill="#581845" stroke="#C70039" stroke-width="2"/>
    <text x="400" y="40" class="label">Overmind</text>

    <rect x="500" y="20" width="100" height="30" rx="4" fill="#581845" stroke="#900C3F" stroke-width="2"/>
    <text x="550" y="40" class="label">AI Agent</text>

    <rect x="650" y="20" width="100" height="30" rx="4" fill="#581845" stroke="#581845" stroke-width="2"/>
    <text x="700" y="40" class="label">Frontend</text>

    <!-- Loop Block -->
    <rect x="30" y="80" width="740" height="450" class="loop-box" />
    <text x="80" y="100" class="label" fill="#FFC300" style="text-anchor: start; font-size: 10px;">LOOP: 60Hz</text>

    <!-- Sequence -->

    <!-- 1. Audio -> Engine -->
    <line x1="100" y1="120" x2="240" y2="120" class="arrow" stroke="#FFC300" />
    <text x="175" y="115" class="msg">Raw PCM Data</text>

    <!-- 2. Engine Internal -->
    <path d="M 250 140 Q 280 155 250 170" stroke="#FF5733" fill="none" stroke-width="2" />
    <text x="290" y="160" class="msg" style="text-anchor: start;">FFT Analysis</text>

    <!-- 3. Engine -> Overmind -->
    <line x1="250" y1="200" x2="390" y2="200" class="arrow" stroke="#FF5733" />
    <text x="325" y="195" class="msg">Update Features</text>

    <!-- Alt Block (AI) -->
    <rect x="380" y="220" width="340" height="120" class="alt-box" />
    <text x="420" y="240" class="label" fill="#900C3F" style="text-anchor: start; font-size: 10px;">IF: New Vibe Needed</text>

    <!-- 4. Overmind -> AI -->
    <line x1="400" y1="260" x2="540" y2="260" class="arrow" stroke="#900C3F" />
    <text x="475" y="255" class="msg">Request Context</text>

    <!-- 5. AI -> Overmind -->
    <line x1="550" y1="300" x2="410" y2="300" class="arrow" stroke="#900C3F" stroke-dasharray="4" />
    <text x="475" y="295" class="msg">Directive JSON</text>

    <!-- 6. Overmind -> Frontend (via WS implicit) -->
    <line x1="400" y1="380" x2="690" y2="380" class="arrow" stroke="#C70039" />
    <text x="550" y="375" class="msg">Broadcast GlobalState (WS)</text>

    <!-- 7. Frontend Render -->
    <path d="M 700 420 Q 730 435 700 450" stroke="#581845" fill="none" stroke-width="2" />
    <text x="740" y="440" class="msg" style="text-anchor: start;">Render Frame</text>

</svg>
